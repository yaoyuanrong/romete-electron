{"version":3,"sources":["../external \"electron\"","../external \"events\"","peer-puppet.js","App.js","reportWebVitals.js","index.js"],"names":["module","exports","require","ipcRenderer","on","e","offer","getScreenStream","addIceCandidate","createAnswer","removeSteam","pc","screenStream","close","ondatachannel","console","log","addStream","setRemoteDescription","setLocalDescription","localDescription","candidate","candidates","push","remoteDescription","type","i","length","RTCIceCandidate","JSON","parse","invoke","sources","Promise","resolve","reject","navigator","webkitGetUserMedia","audio","video","mandatory","chromeMediaSource","chromeMediaSourceId","id","maxWidth","window","screen","width","maxHeight","height","stream","err","error","RTCPeerConnection","channel","onmessage","data","send","onicecandidate","stringify","then","answer","sdp","App","useState","remoteCode","setRemoteCode","localCode","setLocalCode","controlText","setControlText","event","arg","location","reload","login","code","useEffect","handleControlState","removeListener","name","text","onmousedown","className","value","onChange","target","onClick","startControl","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","document","getElementById","render","StrictMode"],"mappings":"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","file":"static/js/main.14509f06.chunk.js","sourcesContent":["module.exports = require(\"electron\");","module.exports = require(\"events\");","const EventEmitter = require('events')\nconst peer = new EventEmitter()\nconst { ipcRenderer } = require('electron')\n\nipcRenderer.on('offer', async (e, offer) => {\n  const pc = new window.RTCPeerConnection({}) // 创建一个datachannel\n  let screenStream\n  // 发现新数据通道传输\n  pc.ondatachannel = (e) => {\n    console.log('发现新的！！！datachannel', e)\n    e.channel.onmessage = (e) => { // 监听数据通道消息\n      console.log('onmessagePuppet', e, JSON.parse(e.data))\n      let { type, data } = JSON.parse(e.data)\n      if(type === 'mouse') {\n        data.screen = { \n          width: window.screen.width,\n          height: window.screen.height\n        }\n      }\n      ipcRenderer.send('robot', type, data)\n    }\n  }\n\n  async function getScreenStream() {\n    let sources = await ipcRenderer.invoke('sources')\n    return new Promise((resolve, reject) => {\n      navigator.webkitGetUserMedia({\n        audio: false,\n        video: {\n          mandatory: {\n            chromeMediaSource: 'desktop',\n            chromeMediaSourceId: sources[0].id,\n            maxWidth: window.screen.width,\n            maxHeight: window.screen.height\n          }\n        }\n      }, (stream) => {\n        resolve(stream)\n      }, (err) => {\n        // error\n        console.error(err)\n      })\n    })\n  }\n\n  /**\n   * @info 设置了本地描述，就开始触发，无论是报价还是答案。\n   *       为localDescription设置了offer或answer\n   **/ \n  pc.onicecandidate = function (e) {\n    if (e.candidate) {\n      console.log('傀儡端candidate', e.candidate)\n      ipcRenderer.send('forward', 'puppet-candidate', JSON.stringify(e.candidate))\n    }\n  }\n\n  ipcRenderer.on('control-candidate', (e, candidate) => {\n    console.log('加入candidate傀儡端')\n    addIceCandidate(candidate)\n  })\n  let candidates = []\n  async function addIceCandidate(candidate) {\n    if(candidate) {\n      candidates.push(candidate)\n    }\n    if (pc.remoteDescription && pc.remoteDescription.type) {\n      for(let i = 0;i < candidates.length;i++) {\n        await pc.addIceCandidate(new RTCIceCandidate(JSON.parse(candidates[i])))\n      }\n      candidates = []\n    }\n  }\n  async function createAnswer(offer) {\n    console.log('answer ')\n    screenStream = await getScreenStream()\n    // 添加视频流信息\n    pc.addStream(screenStream)\n    await pc.setRemoteDescription(offer)\n    await pc.setLocalDescription(await pc.createAnswer())\n    return pc.localDescription\n  }\n  async function removeSteam() {\n    pc.removeSteam(screenStream)\n    pc.close()\n    pc.ondatachannel = null\n  }\n\n  createAnswer(offer).then((answer) => {\n    ipcRenderer.send('forward', 'answer', {type: answer.type, sdp: answer.sdp})\n  })\n  ipcRenderer.on('control-quit-fresh', () =>{\n    console.log('removeSteam')\n    removeSteam()\n  })\n})\n\nexport default peer\n\n\n/**\n * @STUN过程\n * 控制端询问地址 onIceCandidate \n * STUN返回 IceEvent、包含IP+端口 e.candidate\n * 将IceEvent 发送给傀儡端\n * 傀儡端 添加ICE代理 addIceCandidate\n */","import React, {useState, useEffect} from 'react';\nimport './App.css';\nimport { ipcRenderer } from 'electron'\nimport './peer-puppet.js'\n\nfunction App() { \n  const [remoteCode, setRemoteCode] = useState('') // 控制code \n  const [localCode, setLocalCode] = useState('') // 本地的code\n  const [controlText, setControlText] = useState('') // 控制文案\n  ipcRenderer.on('control-quit-fresh', (event, arg) => {\n    window.location.reload()\n  })\n  const login = async () => {\n    let code = await ipcRenderer.invoke('login')\n    setLocalCode(code)\n  }\n  useEffect(() => { //react hook 组件挂载后执行\n    login()\n    ipcRenderer.on('control-state-change', handleControlState)\n    return () => { // 退出后 卸载组件后执行\n      ipcRenderer.removeListener('control-state-change', handleControlState)\n    }\n  }, [])\n  /**\n   * @info 开始告知主进程开始控制\n   * @param {*} remoteCode 控制端的code\n   */\n  const startControl = (remoteCode) => {\n    ipcRenderer.send('control', remoteCode)\n  }\n  const handleControlState = (e, name, type) => {\n    console.log(name)\n    let text = ''\n    if (type === 1) {\n      text = '正在远程控制' + name\n      window.onmousedown = function (e) {\n        console.log(e)\n      } \n    } else {\n      text = '被' + name + '控制'\n    }\n    setControlText(text)\n  }\n  return (\n    <div className=\"App\">\n      {\n        controlText === '' ? <>\n          <div>你的控制码{ localCode }</div>\n          <input type=\"text\" value={remoteCode} onChange={ e => setRemoteCode(e.target.value) } />\n          <button onClick={() => startControl(remoteCode)}>确认</button>\n        </> : <div>{controlText}</div>\n      }\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}